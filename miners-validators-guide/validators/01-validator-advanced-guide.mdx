---
title: "Validator's and Master Validator's Setup Guide"
description: "Setup instructions for running a Validator or Master Validator on MetaHash Subnet 73."
---

## Prerequisites

<Steps>
  <Step title="Infrastructure Requirements">
    - Subtensor lite node with `--pruning=2000` configured
    - Python 3.10+ installed
    - pip/venv for isolated environment
    - A funded coldkey/hotkey wallet with stake registered in Subnet 73
  </Step>
</Steps>

## Setup instructions

<Steps>
  <Step title="Clone and install">
    ```bash
    git clone https://github.com/fx-integral/metahash && cd metahash
    python3 -m venv .venv
    source .venv/bin/activate
    pip install -U pip wheel uv
    uv pip install -e .
    ```
  </Step>

  <Step title="Configure environment">
    Create a `.env` file with your wallet configuration:
    ```bash
    BT_WALLET_NAME=validator-wallet
    BT_HOTKEY=validator-hotkey
    ```
  </Step>

  <Step title="Initialize wallet">
    ```bash
    btcli wallet new_coldkey --wallet.name validator-wallet
    btcli wallet new_hotkey --wallet.name validator-wallet --wallet.hotkey validator-hotkey
    btcli subnets register --wallet.name validator-wallet --wallet.hotkey validator-hotkey --netuid 73
    ```
  </Step>
</Steps>

## Running the Validator

<Tabs>
  <Tab title="Using PM2 (Recommended)">
    ```bash
    pm2 start python --name metahash-validator -- \
      neurons/validator.py \
      --netuid 73 \
      --subtensor.network archive \
      --wallet.name validator-wallet \
      --wallet.hotkey validator-hotkey \
      --neuron.axon_off \
      --logging.debug
    ```

    **Monitor logs:**
    ```bash
    pm2 logs metahash-validator
    ```

    **Auto-restart on reboot:**
    ```bash
    pm2 startup
    pm2 save
    ```
  </Tab>

  <Tab title="Using Docker">
    ```bash
    docker run --rm \
      -v ~/.bittensor:/root/.bittensor:ro \
      ghcr.io/fx-integral/metahash:latest \
      neurons/validator.py \
        --netuid 73 \
        --subtensor.network archive \
        --wallet.name validator-wallet \
        --wallet.hotkey validator-hotkey \
        --neuron.axon_off \
        --logging.debug
    ```
  </Tab>
</Tabs>

<Note>
**Configuration Notes:**
- Map validator hotkey → treasury coldkey in `metahash/treasuries.py`
- Reputation controls & auction budget in `metahash/config.py`
- Subnet weights in `weights.yml`
</Note>

## Master Validator Additional Step

When a validator is promoted to a Master Validator (MV), complete this additional configuration:

<Steps>
  <Step title="Edit treasury mapping">
    ```bash
    vim metahash/treasuries.py
    ```
  </Step>

  <Step title="Add your treasury mapping">
    Inside `treasuries.py`, add your hotkey and corresponding treasury coldkey to the dictionary:

    ```python
    TREASURIES = {
        "validator_hotkey_1": "treasury_coldkey_1",
        "validator_hotkey_2": "treasury_coldkey_2",
        # Add your MV hotkey here
        "my_mv_hotkey": "my_treasury_coldkey",
    }
    ```
  </Step>
</Steps>

<Warning>
This mapping ensures that auction proceeds and α settlements are credited to the correct treasury wallet owned by the subnet.
</Warning>


## Observability & State

Validators maintain structured logs and local JSON state files:

### Structured Logs

Logs are organized by phase:
- **Auction:** Start/end markers and bid collection
- **Clearing:** Bid ranking and winner selection
- **Commitments:** CID publication and IPFS uploads
- **Settlement:** Payment verification and weight setting

### Local JSON State (Atomic Writes)

| File | Purpose |
|------|---------|
| `validated_epochs.json` | Published/settled epochs |
| `pending_commits.json` | Staged commitments awaiting publish |
| `reputation.json` | Per-coldkey reputation / caps |
| `jailed_coldkeys.json` | Enforcement state |

<Accordion title="Optional reporter">
  Use `scripts/validator/report.sh` for automated reporting and monitoring.
</Accordion>

## Configuration Reference

All configuration is environment-driven. Set these variables in your `.env` file:

<Tabs>
  <Tab title="Network / Lifecycle">
    - `BITTENSOR_NETWORK` — Network endpoint
    - `START_V3_BLOCK` — V3 protocol starting block
    - `TESTING` — Enable preview mode (no weight setting)
    - `EPOCH_LENGTH_OVERRIDE` — Override epoch length for testing
  </Tab>

  <Tab title="Auction / Clearing">
    - `AUCTION_BUDGET_ALPHA` — Total α budget per auction
    - `MAX_BIDS_PER_MINER` — Maximum bids per miner per epoch
  </Tab>

  <Tab title="Reputation">
    - `REPUTATION_ENABLED` — Enable reputation system
    - `REPUTATION_BASELINE_CAP_FRAC` — Baseline reputation cap fraction
    - `REPUTATION_MAX_CAP_FRAC` — Maximum reputation cap fraction
  </Tab>

  <Tab title="Slippage">
    - `K_SLIP` — Slippage coefficient
    - `SLIP_TOLERANCE` — Slippage tolerance threshold
    - `SAMPLE_POINTS` — Sample points for slippage calculation
  </Tab>

  <Tab title="Settlement">
    - `STRICT_PER_SUBNET` — Require α payments from source subnet
    - `JAIL_EPOCHS_*` — Jail duration for violations
  </Tab>

  <Tab title="IPFS">
    - `IPFS_API_URL` — IPFS API endpoint
    - `IPFS_GATEWAYS` — List of IPFS gateway URLs
  </Tab>
</Tabs>

## FAQ (Validator-specific)

<AccordionGroup>
  <Accordion title="Do I need IPFS to validate?" icon="question">
    Yes. Commitments are published as CID-only on-chain with full payloads stored in IPFS.
  </Accordion>

  <Accordion title="Why are miner discounts large numbers?" icon="question">
    They're basis points (bps) (1 bp = 0.01%). Example: 500 = 5%.
  </Accordion>

  <Accordion title="What if a miner pays late or to the wrong subnet?" icon="question">
    The line is ignored in settlement; underfill is burned to UID 0.
  </Accordion>
</AccordionGroup>

## Logs & Debugging

<CodeGroup>
```bash View PM2 Logs
pm2 logs metahash-validator
```

```bash Run with Debug Logging
python neurons/validator.py --logging.debug
```

```bash Check Validator Status
btcli subnet metagraph --netuid 73
```

```bash Inspect Reputation
cat reputation.json | jq
```

```bash View Jailed Miners
cat jailed_coldkeys.json | jq
```
</CodeGroup>